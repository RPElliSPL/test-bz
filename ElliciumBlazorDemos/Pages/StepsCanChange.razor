@inject DialogService DialogService

<ElliciumSteps Change="@OnChange" CanChange="@CanChange">
    <Steps>
        <ElliciumStepsItem>
            <ElliciumRow>
                <ElliciumText Text="Enter user information"/>
            </ElliciumRow>
            <ElliciumTextBox Placeholder="Name" @bind-Value="name"/>
            <ElliciumTextBox Placeholder="Address" @bind-Value="address"/>
            <ElliciumButton Text="Save" Click="@SaveNameAndAdress" />
        </ElliciumStepsItem>
        <ElliciumStepsItem>
            <ElliciumRow>
                <ElliciumText Text="Enter about me" />
            </ElliciumRow>
            <ElliciumTextArea Placeholder="About me" @bind-Value="aboutMe" />
            <ElliciumButton Text="Save" Click="@SaveAboutMe" />
        </ElliciumStepsItem>
        <ElliciumStepsItem>
            <ElliciumRow>
                <ElliciumText Text="Add your hobbies" />
            </ElliciumRow>
            <ElliciumDataGrid TItem="Hobby"
                            Data="@hobbies"
                            @bind-Value="@selectedHobbies"
                            SelectionMode="DataGridSelectionMode.Multiple"
                            AllowRowSelectOnRowClick="true" >
                <Columns>
                    <ElliciumDataGridColumn TItem="Hobby" Context="hobby">
                         <Template>
                            <ElliciumCheckBox Value="selectedHobbies.Contains(hobby)" TValue="bool"/>
                        </Template>
                    </ElliciumDataGridColumn>
                    <ElliciumDataGridColumn TItem="Hobby" Title="Hobby" Property="@nameof(Hobby.HobbyName)" />
                </Columns>
            </ElliciumDataGrid>
            <ElliciumButton Text="Save" Click="@SaveHobbies" />
        </ElliciumStepsItem>
    </Steps>
</ElliciumSteps>

@code {
    private string name;
    private string savedName;

    private string address;
    private string savedAddress;

    private string aboutMe;
    private string savedAboutMe;

    private List<Hobby> hobbies = new List<Hobby>() { new("Games"), new("Sport"), new("Movies"), new("Books"), new("Music") };
    private IList<Hobby> selectedHobbies = new List<Hobby>();
    private List<Hobby> savedHobbies = new List<Hobby>();

    private void OnChange()
    {
        name = savedName;
        address = savedAddress;
        aboutMe = savedAboutMe;
        selectedHobbies = savedHobbies;
    }

    private async Task CanChange(StepsCanChangeEventArgs args)
    {
        if (args.SelectedIndex == 0 && savedName == name && savedAddress == address)
        {
            return;
        }

        if (args.SelectedIndex == 1 && savedAboutMe == aboutMe)
        {
            return;
        }

        if (args.SelectedIndex == 2 && savedHobbies.SequenceEqual(selectedHobbies))
        {
            return;
        }

        var response = await DialogService.Confirm(
            "Are you sure you want to contine without saving?",
            "Confirm",
            new ConfirmOptions()
            {
                CloseDialogOnEsc = false,
                CloseDialogOnOverlayClick = false,
                ShowClose = false,
                CancelButtonText = "No",
                OkButtonText = "Yes",
            });

        if (response == false)
        {
            args.PreventDefault();
        }
    }

    private void SaveNameAndAdress()
    {
        savedName = name;
        savedAddress = address;
    }

    private void SaveAboutMe()
    {
        savedAboutMe = aboutMe;
    }

    private void SaveHobbies()
    {
        savedHobbies = selectedHobbies.ToList();
    }

    private class Hobby
    {
        public Hobby(string hobbyName)
        {
            HobbyName = hobbyName;
        }

        public string HobbyName { get; set; }

        public override bool Equals(object obj)
        {
            return obj is Hobby hobby && hobby.HobbyName == HobbyName;
        }

        public override int GetHashCode()
        {
            return HobbyName.GetHashCode();
        }
    }
}