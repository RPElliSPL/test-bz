<div class="container-fluid">
    <div class="row px-3">
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Single file upload</ElliciumText>
                <ElliciumUpload Url="upload/single" Progress=@(args => OnProgress(args, "Single file upload")) class="w-100" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})">
                </ElliciumUpload>
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Upload with icon</ElliciumText>
                <ElliciumUpload Url="upload/single" Icon="upload" ChooseText="" Progress=@(args => OnProgress(args, "Upload with icon")) InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})">
                </ElliciumUpload>
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Custom HTTP headers</ElliciumText>
                <ElliciumUpload Url="upload/single" Progress=@(args => OnProgress(args, "Custom HTTP headers")) class="w-100" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})">
                    <ElliciumUploadHeader Name="Authorization" Value="Bearer <token>" />
                    <ElliciumUploadHeader Name="X-Uploaded-By" Value="Ellicium" />
                </ElliciumUpload>
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Multiple files upload</ElliciumText>
                <ElliciumUpload Multiple="true" Url="upload/multiple" Progress=@(args => OnProgress(args, "Multiple files upload")) class="w-100" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})" />
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Upload images only</ElliciumText>
                <ElliciumUpload Multiple="true" Accept="image/*" Url="upload/multiple" Progress=@(args => OnProgress(args, "Images only upload")) class="w-100" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})" />
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Upload with additional parameter</ElliciumText>
                <ElliciumUpload Multiple="true" Accept="image/*" Url=@($"upload/{customParameter}") Progress=@(args => OnProgress(args, "Upload with additional parameter")) class="w-100" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})" />
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Upload Complete event</ElliciumText>
                <ElliciumUpload Url="upload/single" Complete=@OnComplete class="w-100" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})" />
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Using ElliciumProgressBar</ElliciumText>
                <ElliciumUpload Url="upload/single" Progress=@TrackProgress Complete=@CompleteUpload class="w-100" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})" />
                <ElliciumProgressBar Value=@progress class="mt-4" Visible=@showProgress />
                <ElliciumButton Text="Cancel" Click=@(args => CancelUpload()) class="d-block mt-4" Visible=@showProgress />
                <ElliciumLabel Visible=@showComplete class="mt-4" Text=@completionMessage />
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Specify upload parameter name</ElliciumText>
                <ElliciumUpload Url="upload/specific" ParameterName="myName" Progress=@(args => OnProgress(args, "Upload with specified parameter name")) class="w-100" InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})" />
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Upload client-side without Url</ElliciumText>
                <ElliciumUpload Multiple="true" Change=@OnClientChange class="w-100" 
                    InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})" />
            </ElliciumCard>
        </div>
        <div class="col-md-6 p-3">
            <ElliciumCard>
                <ElliciumText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Manual Upload</ElliciumText>
                <ElliciumUpload @ref="upload" Auto="false" Multiple="true" Url="upload/multiple" Change=@(args => OnChange(args, "Manual Upload")) InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})"
                        Progress=@(args => OnProgress(args, "Manual Upload")) class="w-100" />
                <ElliciumButton Text="Upload" Click=@(args => upload.Upload()) class="d-block mt-4" />
            </ElliciumCard>
        </div>
    </div>
</div>

<EventConsole @ref=@console />

@code {
    EventConsole console;

    ElliciumUpload upload;

    int progress;
    bool showProgress;
    bool showComplete;
    string completionMessage;
    bool cancelUpload = false;

    void CompleteUpload(UploadCompleteEventArgs args)
    {
        if (!args.Cancelled)
            completionMessage = "Upload Complete!";
        else
            completionMessage = "Upload Cancelled!";

        showProgress = false;
        showComplete = true;
    }

    void TrackProgress(UploadProgressArgs args)
    {
        showProgress = true;
        showComplete = false;
        progress = args.Progress;

        // cancel upload
        args.Cancel = cancelUpload;

        // reset cancel flag
        cancelUpload = false;
    }

    void CancelUpload()
    {
        cancelUpload = true;
    }

    int customParameter = 1;

    void OnChange(UploadChangeEventArgs args, string name)
    {
        foreach (var file in args.Files)
        {
            console.Log($"File: {file.Name} / {file.Size} bytes");
        }

        console.Log($"{name} changed");
    }

    void OnProgress(UploadProgressArgs args, string name)
    {
        console.Log($"{args.Progress}% '{name}' / {args.Loaded} of {args.Total} bytes.");

        if (args.Progress == 100)
        {
            foreach (var file in args.Files)
            {
                console.Log($"Uploaded: {file.Name} / {file.Size} bytes");
            }
        }
    }

    void OnComplete(UploadCompleteEventArgs args)
    {
        console.Log($"Server response: {args.RawResponse}");
    }

    void OnClientChange(UploadChangeEventArgs args)
    {
        console.Log($"Client-side upload changed");

        foreach (var file in args.Files)
        {
            console.Log($"File: {file.Name} / {file.Size} bytes");

            try
            {
                long maxFileSize = 10 * 1024 * 1024;
                // read file
                var stream = file.OpenReadStream(maxFileSize);
                stream.Close();
            }
            catch (Exception ex)
            { 
                console.Log($"Client-side file read error: {ex.Message}");
            }
        }
    }
}