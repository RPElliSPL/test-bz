@using ElliciumBlazorDemos.Data
@using ElliciumBlazorDemos.Models.Northwind
@using Microsoft.EntityFrameworkCore

@inherits DbContextPage

@if(position == 0)
{
    <style>
        .rz-panel-titlebar {
            flex-direction: row-reverse;
            justify-content:left;
        }
    </style>
}

<ElliciumStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center" Class="rz-p-4 rz-mb-6 rz-border-radius-1" Style="border: var(--rz-grid-cell-border);">
    <ElliciumText TextStyle="TextStyle.Body1">Expand/Collapse position:</ElliciumText>
    <ElliciumSelectBar @bind-Value="@position" TextProperty="Text" ValueProperty="Value"
                     Data="@(new []{ new { Text = "Left", Value = 0 }, new { Text = "Right", Value = 1 } })" Size="ButtonSize.Small" />
</ElliciumStack>

<ElliciumPanel AllowCollapse="true" Class="rz-my-10 rz-mx-auto" Style="width: 700px;"
                Expand=@(() => Change("Panel expanded")) Collapse=@(() => Change("Panel collapsed")) >
    <HeaderTemplate>
        <ElliciumText TextStyle="TextStyle.H6" Class="rz-display-flex rz-align-items-center rz-m-0">
            <ElliciumIcon Icon="account_box" class="rz-mr-1" /><b>Orders</b>
        </ElliciumText>
    </HeaderTemplate>
    <ChildContent>
        <ElliciumCard  class="rz-mt-4">
            <ElliciumDataList PageSize="4" WrapItems="true" AllowPaging="true" 
                            Data="@orders" TItem="Order">
                <Template Context="order">
                    <ElliciumCard Style="width: 250px">
                        <ElliciumRow>
                            <ElliciumColumn Size="8" class="rz-text-truncate">
                                <ElliciumBadge BadgeStyle="BadgeStyle.Light" Text=@($"{order.OrderID}") class="me-1" />
                                <b>@(order.ShipName)</b>
                            </ElliciumColumn>
                            <ElliciumColumn Size="4" class="rz-text-align-end">
                                <ElliciumBadge BadgeStyle="BadgeStyle.Success" Text=@($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", order.Freight)}") />
                            </ElliciumColumn>
                        </ElliciumRow>
                        <hr style="border: none; background-color: var(--rz-text-disabled-color); height: 1px; margin: 1rem 0;" />
                        <ElliciumStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="1rem">
                            <ElliciumImage Path="@order.Employee?.Photo" Style="width: 80px; height: 80px; border-radius: 50%" AlternateText="@(order.Employee?.FirstName + " " + order.Employee?.LastName)" />
                            <ElliciumStack Gap="0">
                                <ElliciumText TextStyle="TextStyle.H6" Class="rz-mb-0">@(order.Employee?.FirstName + " " + order.Employee?.LastName)</ElliciumText>
                                <ElliciumText TextStyle="TextStyle.Body1">@order.ShipAddress</ElliciumText>
                                <ElliciumText TextStyle="TextStyle.Body2">@(order.ShipCity), @(order.ShipCountry)</ElliciumText>
                            </ElliciumStack>
                        </ElliciumStack>
                    </ElliciumCard>
                </Template>
            </ElliciumDataList>
        </ElliciumCard>
    </ChildContent>
    <SummaryTemplate>
        <ElliciumCard class="rz-mt-4">
            <b>@orders.Count() Orders</b>
        </ElliciumCard>
    </SummaryTemplate>
</ElliciumPanel>

<EventConsole @ref=@console />

@code {
    int position = 1;
    EventConsole console;

    IEnumerable<Order> orders;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        orders = dbContext.Orders.Include("Customer").Include("Employee").ToList();
    }

    void Change(string text)
    {
        console.Log($"{text}");
    }
}